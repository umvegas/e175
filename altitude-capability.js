var tableData = {
    LRC : {
        88000 : {
            "-15" : [290, 290],
            "-10" : [340, 310],
             "-5" : [350, 310],
              0 : [350, 320],
              5 : [340, 320],
             10 : [340, 310],
             15 : [340, 310],
             20 : [340, 310],
        },
        86000 : {
            "-15" : [290, 290],
            "-10" : [340, 320],
             "-5" : [350, 320],
              0 : [350, 320],
              5 : [350, 320],
             10 : [350, 320],
             15 : [350, 320],
             20 : [340, 320],
        },
        84000 : {
            "-15" : [290, 290],
            "-10" : [340, 320],
             "-5" : [350, 320],
              0 : [350, 320],
              5 : [350, 320],
             10 : [350, 320],
             15 : [350, 320],
             20 : [340, 320],
        },
        82000 : {
            "-15" : [290, 290],
            "-10" : [340, 330],
             "-5" : [350, 330],
              0 : [350, 330],
              5 : [350, 330],
             10 : [350, 330],
             15 : [350, 330],
             20 : [340, 330],
        },
        80000 : {
            "-15" : [290, 290],
            "-10" : [340, 330],
             "-5" : [360, 340],
              0 : [360, 340],
              5 : [360, 340],
             10 : [360, 330],
             15 : [350, 330],
             20 : [350, 330],
        },
        78000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [360, 340],
              0 : [360, 340],
              5 : [360, 340],
             10 : [360, 340],
             15 : [360, 340],
             20 : [360, 340],
        },
        76000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [370, 350],
              0 : [370, 350],
              5 : [370, 350],
             10 : [370, 350],
             15 : [360, 350],
             20 : [360, 350],
        },
        74000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [370, 350],
              0 : [370, 350],
              5 : [370, 350],
             10 : [370, 350],
             15 : [370, 350],
             20 : [360, 350],
        },
        72000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [380, 360],
              0 : [380, 360],
              5 : [380, 360],
             10 : [380, 360],
             15 : [370, 360],
             20 : [370, 360],
        },
        70000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [380, 360],
              0 : [380, 360],
              5 : [380, 360],
             10 : [380, 360],
             15 : [380, 360],
             20 : [370, 360],
        },
        68000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [390, 370],
              0 : [390, 370],
              5 : [390, 370],
             10 : [390, 370],
             15 : [380, 370],
             20 : [380, 370],
        },
        66000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [390, 380],
              0 : [390, 380],
              5 : [390, 380],
             10 : [390, 380],
             15 : [390, 380],
             20 : [380, 380],
        },
        64000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [400, 380],
              0 : [400, 380],
              5 : [400, 380],
             10 : [400, 380],
             15 : [390, 380],
             20 : [380, 380],
        },
        62000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [410, 390],
              0 : [410, 390],
              5 : [410, 390],
             10 : [410, 390],
             15 : [400, 390],
             20 : [390, 390],
        },
        60000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [410, 400],
              0 : [410, 400],
              5 : [410, 400],
             10 : [410, 400],
             15 : [410, 400],
             20 : [390, 390],
        },
    },
    'Mach 0.74' : {
        88000 : {
            "-15" : [290, 290],
            "-10" : [340, 320],
             "-5" : [340, 320],
              0 : [340, 320],
              5 : [340, 320],
             10 : [340, 320],
             15 : [330, 320],
             20 : [320, 320],
        },
        86000 : {
            "-15" : [290, 290],
            "-10" : [340, 330],
             "-5" : [350, 330],
              0 : [350, 330],
              5 : [350, 330],
             10 : [350, 330],
             15 : [340, 330],
             20 : [330, 330],
        },
        84000 : {
            "-15" : [290, 290],
            "-10" : [340, 330],
             "-5" : [350, 330],
              0 : [350, 330],
              5 : [350, 330],
             10 : [350, 330],
             15 : [340, 330],
             20 : [330, 330],
        },
        82000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [350, 340],
              0 : [350, 340],
              5 : [350, 340],
             10 : [350, 340],
             15 : [340, 340],
             20 : [330, 330],
        },
        80000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [360, 340],
              0 : [360, 340],
              5 : [360, 340],
             10 : [360, 340],
             15 : [350, 340],
             20 : [340, 340],
        },
        78000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [360, 350],
              0 : [360, 350],
              5 : [360, 350],
             10 : [360, 350],
             15 : [360, 350],
             20 : [350, 350],
        },
        76000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [370, 350],
              0 : [370, 350],
              5 : [370, 350],
             10 : [370, 350],
             15 : [360, 350],
             20 : [350, 350],
        },
        74000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [370, 360],
              0 : [370, 360],
              5 : [370, 360],
             10 : [370, 360],
             15 : [360, 360],
             20 : [360, 360],
        },
        72000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [380, 360],
              0 : [380, 360],
              5 : [380, 360],
             10 : [380, 360],
             15 : [370, 360],
             20 : [360, 360],
        },
        70000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [380, 370],
              0 : [380, 370],
              5 : [380, 370],
             10 : [380, 370],
             15 : [370, 370],
             20 : [360, 360],
        },
        68000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [390, 380],
              0 : [390, 380],
              5 : [390, 380],
             10 : [390, 380],
             15 : [380, 380],
             20 : [370, 370],
        },
        66000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [390, 380],
              0 : [390, 380],
              5 : [390, 380],
             10 : [390, 380],
             15 : [380, 380],
             20 : [380, 380],
        },
        64000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [400, 390],
              0 : [400, 390],
              5 : [400, 390],
             10 : [400, 390],
             15 : [390, 390],
             20 : [380, 380],
        },
        62000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [400, 400],
              0 : [400, 400],
              5 : [400, 400],
             10 : [400, 400],
             15 : [390, 390],
             20 : [390, 390],
        },
        60000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [410, 400],
              0 : [410, 400],
              5 : [410, 400],
             10 : [410, 400],
             15 : [400, 400],
             20 : [390, 390],
        },
    },
    'Mach 0.75' : {
        88000 : {
            "-15" : [290, 290],
            "-10" : [340, 320],
             "-5" : [340, 320],
              0 : [340, 320],
              5 : [340, 320],
             10 : [340, 320],
             15 : [330, 320],
        },
        84000 : {
            "-15" : [290, 290],
            "-10" : [340, 330],
             "-5" : [340, 330],
              0 : [340, 330],
              5 : [340, 330],
             10 : [340, 330],
             15 : [330, 330],
             20 : [320, 330],
        },
        80000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [350, 340],
              0 : [350, 340],
              5 : [350, 340],
             10 : [350, 340],
             15 : [340, 340],
             20 : [330, 330],
        },
        76000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [360, 350],
              0 : [360, 350],
              5 : [360, 350],
             10 : [360, 350],
             15 : [360, 350],
             20 : [340, 340],
        },
        72000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [370, 360],
              0 : [370, 360],
              5 : [370, 360],
             10 : [370, 360],
             15 : [370, 360],
             20 : [360, 360],
        },
        68000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [380, 380],
              0 : [380, 380],
              5 : [380, 380],
             10 : [380, 380],
             15 : [380, 380],
             20 : [370, 370],
        },
        64000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [400, 400],
              0 : [400, 400],
              5 : [400, 400],
             10 : [400, 400],
             15 : [390, 390],
             20 : [380, 380],
        },
    },
    'Mach 0.76' : {
        88000 : {
            "-15" : [290, 290],
            "-10" : [340, 320],
             "-5" : [340, 320],
              0 : [340, 320],
              5 : [340, 320],
             10 : [340, 320],
             15 : [330, 320],
        },
        86000 : {
            "-15" : [290, 290],
            "-10" : [340, 330],
             "-5" : [340, 330],
              0 : [340, 330],
              5 : [340, 330],
             10 : [340, 330],
             15 : [340, 330],
             20 : [310, 310],
        },
        84000 : {
            "-15" : [290, 290],
            "-10" : [340, 330],
             "-5" : [340, 330],
              0 : [340, 330],
              5 : [340, 330],
             10 : [340, 330],
             15 : [340, 330],
             20 : [320, 320],
        },
        82000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [340, 340],
              0 : [340, 340],
              5 : [340, 340],
             10 : [340, 340],
             15 : [340, 340],
             20 : [320, 320],
        },
        80000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [350, 340],
              0 : [350, 340],
              5 : [350, 340],
             10 : [350, 340],
             15 : [340, 340],
             20 : [330, 330],
        },
        78000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [360, 350],
              0 : [360, 350],
              5 : [360, 350],
             10 : [360, 350],
             15 : [350, 350],
             20 : [330, 330],
        },
        76000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [360, 350],
              0 : [360, 350],
              5 : [360, 350],
             10 : [360, 350],
             15 : [360, 350],
             20 : [340, 340],
        },
        74000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [370, 360],
              0 : [370, 360],
              5 : [370, 360],
             10 : [370, 360],
             15 : [360, 360],
             20 : [350, 350],
        },
        72000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [370, 360],
              0 : [370, 360],
              5 : [370, 360],
             10 : [370, 360],
             15 : [370, 360],
             20 : [360, 360],
        },
        70000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [380, 370],
              0 : [380, 370],
              5 : [380, 370],
             10 : [380, 370],
             15 : [370, 370],
             20 : [360, 360],
        },
        68000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [380, 380],
              0 : [380, 380],
              5 : [380, 380],
             10 : [380, 380],
             15 : [380, 380],
             20 : [370, 370],
        },
        66000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [390, 380],
              0 : [390, 380],
              5 : [390, 380],
             10 : [390, 380],
             15 : [380, 380],
             20 : [370, 370],
        },
        64000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [390, 390],
              0 : [390, 390],
              5 : [390, 390],
             10 : [390, 390],
             15 : [390, 380],
             20 : [380, 380],
        },
        62000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [400, 400],
              0 : [400, 400],
              5 : [400, 400],
             10 : [400, 400],
             15 : [390, 390],
             20 : [380, 380],
        },
        60000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [400, 400],
              0 : [400, 400],
              5 : [400, 400],
             10 : [400, 400],
             15 : [390, 390],
             20 : [380, 380],
        },
    },
    'Mach 0.78' : {
        88000 : {
            "-15" : [290, 290],
            "-10" : [330, 320],
             "-5" : [330, 320],
              0 : [330, 320],
              5 : [330, 320],
             10 : [330, 320],
             15 : [320, 320],
        },
        86000 : {
            "-15" : [290, 290],
            "-10" : [340, 320],
             "-5" : [340, 320],
              0 : [340, 320],
              5 : [340, 320],
             10 : [340, 320],
             15 : [330, 320],
        },
        84000 : {
            "-15" : [290, 290],
            "-10" : [340, 330],
             "-5" : [340, 330],
              0 : [340, 330],
              5 : [340, 330],
             10 : [340, 330],
             15 : [330, 330],
        },
        82000 : {
            "-15" : [290, 290],
            "-10" : [340, 330],
             "-5" : [340, 330],
              0 : [340, 330],
              5 : [340, 330],
             10 : [340, 330],
             15 : [330, 330],
        },
        80000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [340, 340],
              0 : [340, 340],
              5 : [340, 340],
             10 : [340, 340],
             15 : [340, 340],
        },
        78000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [350, 340],
              0 : [350, 340],
              5 : [350, 340],
             10 : [350, 340],
             15 : [340, 340],
             20 : [310, 310],
        },
        76000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [360, 350],
              0 : [360, 350],
              5 : [360, 350],
             10 : [360, 350],
             15 : [360, 350],
             20 : [330, 330],
        },
        74000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [360, 350],
              0 : [360, 350],
              5 : [360, 350],
             10 : [360, 350],
             15 : [360, 350],
             20 : [340, 340],
        },
        72000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [370, 360],
              0 : [370, 360],
              5 : [370, 360],
             10 : [370, 360],
             15 : [360, 360],
             20 : [360, 350],
        },
        70000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [370, 360],
              0 : [370, 360],
              5 : [370, 360],
             10 : [370, 360],
             15 : [370, 360],
             20 : [360, 360],
        },
        68000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [380, 370],
              0 : [380, 370],
              5 : [380, 370],
             10 : [380, 370],
             15 : [370, 370],
             20 : [360, 360],
        },
        66000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [380, 380],
              0 : [380, 380],
              5 : [380, 380],
             10 : [380, 380],
             15 : [380, 380],
             20 : [370, 370],
        },
        64000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [390, 380],
              0 : [390, 380],
              5 : [390, 380],
             10 : [390, 380],
             15 : [380, 380],
             20 : [370, 370],
        },
        62000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [390, 390],
              0 : [390, 390],
              5 : [390, 390],
             10 : [390, 390],
             15 : [390, 390],
             20 : [380, 380],
        },
        60000 : {
            "-15" : [290, 290],
            "-10" : [340, 340],
             "-5" : [400, 400],
              0 : [400, 400],
              5 : [400, 400],
             10 : [400, 400],
             15 : [390, 390],
             20 : [380, 380],
        },
    },
};
function printTable(speed) {
    var bye,
        data = tableData[speed],
        weights = Object.keys(data),
        temperatures = (function () {
            var map = {};
            Object.values(data).forEach(weightData => {
                Object.keys(weightData).forEach(temperature => {
                    map[temperature] = true;
                });
            });
            return Object.keys(map).sort((a, b) => {
                return +a > +b ? 1 :
                       +a < +b ? -1 : 0;
            });
        }());
    M(['table',
       ['with', table => {
           bye = () => table.remove();
       }],
       ['attr', ['cellspacing', 0]],
       ['tr',
        ['th', speed,
         ['style', ['border', '1px solid black'],
          ['cursor', 'pointer']],
         ['attr',
          ['colspan', 1 + temperatures.length]],
         ['on',
          ['click', e => {
              if (!confirm("Really drop " + speed + "?")) { return; }
              bye();
          }]]]],
       ['tr',
        ['th', 'weight/temp', ['style', ['border', '1px solid black']]],
        ['with', tempRow => {
            temperatures.forEach(temperature => {
                M(['th', temperature,
                   ['style', ['border', '1px solid black']]], tempRow);
            });
        }]],
       ['tbody',
        ['with', tbody => {
            weights.concat().reverse().forEach(weight => {
                M(['tr',
                   ['td', weight,
                    ['style', ['border', '1px solid black']]],
                   ['with', weightRow => {
                       temperatures.forEach(temperature => {
                           var [lim13, lim15] = data[weight][temperature] || ['---', '---'];
                           M(['td',
                              ['style', ['border', '1px solid black']],
                              ['div', lim13,
                               ['style', ['padding', '0 1em']]],
                              ['div', lim15,
                               ['style', ['padding', '0 1em'],
                                ['background', 'lightgray']]]], weightRow);
                       });
                   }]], tbody);
            });
        }]]], document.body);
}
function interpolate() {
    var d = tableData['Mach 0.75'];
    [86000, 82000, 78000, 74000, 70000, 66000].forEach(newWeight => {
        d[newWeight] = {};
        temperatures.forEach(t => {
            var over = d[newWeight + 2000][t],
                under = d[newWeight - 2000][t];
            if (!over || !under) { return; }
            d[newWeight][t] = [(over[0] + under[0]) / 2,
                               (over[1] + under[1]) / 2];
        });
    });
}
function findSpeeds() {
    return Object.keys(tableData);
}
function findWeights() {
    var weightMap = {};
    speeds.forEach(speed => {
        const speedWeights = Object.keys(tableData[speed]);
        speedWeights.forEach(speedWeight => {
            weightMap[speedWeight] = true;
        });
    });
    return Object.keys(weightMap);
}
function slider(startingValue, step, values, name, label) {
    var showValue;
    function set(v) {
        var o = {};
        o[name] = v;
        lookup(o);
    }
    M(['div',
       ['style',
        ['margin', '.5em'],
        ['display', 'inline-block'],
        ['border', '2px solid lightgray'],
        ['borderRadius', '8px']],
       ['div', label + startingValue,
        ['style', ['textAlign', 'center'],
         ['margin', '.5em 0']],
        ['with', n => {
            showValue = v => {
                n.innerHTML = label + v;
            };
            set(startingValue);
        }]],
       ['input',
        ['style', ['width', '320px']],
        ['attr',
         ['type', 'range'],
         ['step', step],
         ['min', Math.min(...values)],
         ['max', Math.max(...values)],
         ['value', startingValue]],
        ['on', ['input', e => {
            const v = e.target.value;
            showValue(v);
            set(v);
        }]]]], document.body);
}
const speeds = findSpeeds();
const weights = findWeights();
const temperatures = [20, 15, 10, 5, 0, -5, -10, -15, -20];
const altitudes = [290, 300, 310, 320, 330, 340, 350, 360, 370, 380, 390, 400, 410];
var showResult, showNoData, limitDivFuns = [];
function runLimitDivFuns(params) {
    limitDivFuns.forEach(f => f(params));
}
function registerLimitDivFun(f) {
    limitDivFuns.push(f);
}
var lookup = (function () {
    var altitude, speed, weight, temperature;
    return function look_up(o = {}) {
        if (o.altitude !== undefined) {
            altitude = o.altitude;
            console.log({ altitude });
        }
        if (o.speed !== undefined) {
            speed = o.speed;
            console.log({ speed });
        }
        if (o.weight !== undefined) {
            weight = o.weight;
            console.log({ weight });
        }
        if (o.temperature !== undefined) {
            temperature = o.temperature;
            console.log({ temperature });
        }
        if (altitude === undefined) { return; }
        if (temperature === undefined) { return; }
        if (weight === undefined) { return; }
        if (speed === undefined) { return; }
        if (showResult) {
            let result = tableData[speed][weight] &&
                         tableData[speed][weight][temperature];
            let isOK = result && result.map(limit => limit - altitude);
            if (isOK) {
                showResult(result.concat(isOK));
            } else {
                showNoData();
            }
            runLimitDivFuns({ temperature, weight });
        } else {
            setTimeout(look_up, 1000);
        }
    };
}());
function speedButtons() {
    var dim;
    return ['div',
            ['div', 'Speed',
             ['style', ['textAlign', 'center'], ['margin', '.5em 0']]],
            ['div',
             ['style',
              ['textAlign', 'center']],
             ['with', btnRow => {
                 speeds.forEach(speed => {
                     var machNumber = speed.match(/LRC/) ? speed :
                                      speed.match(/\.\d\d/)[0];
                     M(['div',
                        ['div', machNumber],
                        ['div',
                         ['with', limitDiv => {
                             registerLimitDivFun(({ temperature, weight }) => {
                                 //limitDiv.innerHTML = temperature + "&deg;C, " + weight + "lbs";
                                 limitDiv.innerHTML = tableData[speed][weight][temperature].join('/');
                             });
                         }]],
                        ['style',
                         ['display', 'inline-block'],
                         ['borderRadius', '5px'],
                         ['cursor', 'pointer'],
                         ['padding', '5px 0'],
                         ['margin', '0 2px'],
                         ['textAlign', 'center'],
                         ['width', '17%'],
                         ['border', '2px solid lightgray']],
                        ['with', btn => {
                            function lite() {
                                lookup({ speed });
                                dim && dim();
                                btn.style.background = 'lightgreen';
                                dim = () => {
                                    btn.style.background = 'none';
                                };
                            }
                            M(['on', ['click', lite]], btn);
                            if (speed.match(/75/)) {
                                lite();
                            }
                        }]], btnRow);
                 });
             }]]];
}
//////////////////////////////////////////////////////////////////////////
interpolate();
M(['div',
   ['style', ['maxWidth', '600px']],
   ['with', div => {
       showNoData = () => {
           div.innerHTML = 'no data available for these parameters';
       };
       showResult = ([limit13, limit15, ok13, ok15]) => {
           div.innerHTML = '';
           M(['div',
              ['div', '1.3g: FL' + limit13,
               ['style',
                ['fontSize', '36px'],
                ['textAlign', 'center'],
                ['padding', '.5em'],
                ['margin', '.5em'],
                ['background',
                 ok13 > 0 ? 'lightgreen' :
                 ok13 < 0 ? 'red' : 'yellow']]],
              ['div', '1.5g: FL' + limit15,
               ['style',
                ['fontSize', '36px'],
                ['textAlign', 'center'],
                ['padding', '.5em'],
                ['margin', '.5em'],
                ['background',
                 ok15 > 0 ? 'lightgreen' :
                 ok15 < 0 ? 'red' : 'yellow']]]], div);
       };
   }]], document.body);
slider(0, 5, temperatures, 'temperature', 'Temp: ');
slider(350, 10, altitudes, 'altitude', 'FL');
slider(76000, 2000, weights, 'weight', 'Weight: ');
M(speedButtons, document.body);
lookup();
